{"code":"(()=>{\nvar __defProp=Object.defineProperty;var __getOwnPropDesc=Object.getOwnPropertyDescriptor;var __getOwnPropNames=Object.getOwnPropertyNames;var __hasOwnProp=Object.prototype.hasOwnProperty;var __name=(target,value)=>__defProp(target,\"name\",{value,configurable:true});var __export=(target,all)=>{for(var name in all)__defProp(target,name,{get:all[name],enumerable:true})};var __copyProps=(to,from,except,desc)=>{if(from&&typeof from===\"object\"||typeof from===\"function\"){for(let key of __getOwnPropNames(from))if(!__hasOwnProp.call(to,key)&&key!==except)__defProp(to,key,{get:()=>from[key],enumerable:!(desc=__getOwnPropDesc(from,key))||desc.enumerable})}return to};var __toCommonJS=mod=>__copyProps(__defProp({},\"__esModule\",{value:true}),mod);var core_exports={};__export(core_exports,{default:()=>core_default});module.exports=__toCommonJS(core_exports);var import_node_stream=require(\"node:stream\");var import_promises=require(\"node:stream/promises\");var import_node_timers=require(\"node:timers\");const defaultLambdaHandler=__name(()=>{},\"defaultLambdaHandler\");const defaultPlugin={timeoutEarlyInMillis:5,timeoutEarlyResponse:__name(()=>{const err=new Error(\"[AbortError]: The operation was aborted.\",{cause:{package:\"@middy/core\"}});err.name=\"TimeoutError\";throw err},\"timeoutEarlyResponse\"),streamifyResponse:false};const middy=__name((lambdaHandler=defaultLambdaHandler,plugin={})=>{if(typeof lambdaHandler!==\"function\"){plugin=lambdaHandler;lambdaHandler=defaultLambdaHandler}plugin={...defaultPlugin,...plugin};plugin.timeoutEarly=plugin.timeoutEarlyInMillis>0;plugin.beforePrefetch?.();const beforeMiddlewares=[];const afterMiddlewares=[];const onErrorMiddlewares=[];const middyHandler=__name((event={},context={})=>{plugin.requestStart?.();const request={event,context,response:void 0,error:void 0,internal:plugin.internal??{}};return runRequest(request,beforeMiddlewares,lambdaHandler,afterMiddlewares,onErrorMiddlewares,plugin)},\"middyHandler\");const middy2=plugin.streamifyResponse?awslambda.streamifyResponse(async(event,responseStream,context)=>{const handlerResponse=await middyHandler(event,context);let handlerBody=handlerResponse;if(handlerResponse.statusCode){handlerBody=handlerResponse.body??\"\";delete handlerResponse.body;responseStream=awslambda.HttpResponseStream.from(responseStream,handlerResponse)}let handlerStream;if(handlerBody._readableState){handlerStream=handlerBody}else if(typeof handlerBody===\"string\"){handlerStream=import_node_stream.Readable.from(handlerBody.length<stringIteratorSize?handlerBody:stringIterator(handlerBody))}if(!handlerStream){throw new Error(\"handler response not a ReadableStream\")}await(0,import_promises.pipeline)(handlerStream,responseStream)}):middyHandler;middy2.use=middlewares=>{if(!Array.isArray(middlewares)){middlewares=[middlewares]}for(const middleware of middlewares){const{before,after,onError}=middleware;if(before||after||onError){if(before)middy2.before(before);if(after)middy2.after(after);if(onError)middy2.onError(onError)}else{throw new Error('Middleware must be an object containing at least one key among \"before\", \"after\", \"onError\"')}}return middy2};middy2.before=beforeMiddleware=>{beforeMiddlewares.push(beforeMiddleware);return middy2};middy2.after=afterMiddleware=>{afterMiddlewares.unshift(afterMiddleware);return middy2};middy2.onError=onErrorMiddleware=>{onErrorMiddlewares.unshift(onErrorMiddleware);return middy2};middy2.handler=replaceLambdaHandler=>{lambdaHandler=replaceLambdaHandler;return middy2};return middy2},\"middy\");const stringIteratorSize=16384;function*stringIterator(input){let position=0;const length=input.length;while(position<length){yield input.substring(position,position+stringIteratorSize);position+=stringIteratorSize}}__name(stringIterator,\"stringIterator\");let handlerAbort=new AbortController;const runRequest=__name(async(request,beforeMiddlewares,lambdaHandler,afterMiddlewares,onErrorMiddlewares,plugin)=>{let timeoutID;const timeoutEarly=plugin.timeoutEarly&&request.context.getRemainingTimeInMillis;try{await runMiddlewares(request,beforeMiddlewares,plugin);if(!Object.prototype.hasOwnProperty.call(request,\"earlyResponse\")){plugin.beforeHandler?.();if(handlerAbort.signal.aborted){handlerAbort=new AbortController}const promises=[lambdaHandler(request.event,request.context,{signal:handlerAbort.signal})];if(timeoutEarly){let timeoutResolve;const timeoutPromise=new Promise((resolve,reject)=>{timeoutResolve=__name(()=>{handlerAbort.abort();try{resolve(plugin.timeoutEarlyResponse())}catch(e){reject(e)}},\"timeoutResolve\")});timeoutID=(0,import_node_timers.setTimeout)(timeoutResolve,request.context.getRemainingTimeInMillis()-plugin.timeoutEarlyInMillis);promises.push(timeoutPromise)}request.response=await Promise.race(promises);if(timeoutID){clearTimeout(timeoutID)}plugin.afterHandler?.();await runMiddlewares(request,afterMiddlewares,plugin)}}catch(e){if(timeoutID){clearTimeout(timeoutID)}request.response=void 0;request.error=e;try{await runMiddlewares(request,onErrorMiddlewares,plugin)}catch(e2){e2.originalError=request.error;request.error=e2;throw request.error}if(typeof request.response===\"undefined\")throw request.error}finally{await plugin.requestEnd?.(request)}return request.response},\"runRequest\");const runMiddlewares=__name(async(request,middlewares,plugin)=>{for(const nextMiddleware of middlewares){plugin.beforeMiddleware?.(nextMiddleware.name);const res=await nextMiddleware(request);plugin.afterMiddleware?.(nextMiddleware.name);if(typeof res!==\"undefined\"){request.earlyResponse=res}if(Object.prototype.hasOwnProperty.call(request,\"earlyResponse\")){request.response=request.earlyResponse;return}}},\"runMiddlewares\");var core_default=middy;\n})()\n","warnings":[],"map":{"version":3,"mappings":"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","names":["middy","e"],"ignoreList":[],"sources":["C:\\Users\\Angel Cubas\\projects\\indra-challenge\\node_modules\\.pnpm\\@middy+core@6.0.0\\node_modules\\@middy\\core\\index.js"],"sourcesContent":[null]}}